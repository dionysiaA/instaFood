{"version":3,"sources":["../src/app.js"],"names":["InstagramAPI","require","use","init","preload","ns","fallbackNS","detection","lookupCookie","backend","loadPath","resolve","__dirname","addPath","app","set","origin","cb","whitelist","process","env","CORS_ORIGIN","split","includes","credentials","urlencoded","extended","json","store","client","name","resave","saveUninitialized","secret","SESSION_SECRET","handle","initialize","session","get","req","res","type","send","schema","context","user","graphiql","NODE_ENV","pretty","message","render","params","template","t","v","html","email","instagramAPI","userSelfMedia","then","media","console","log","data","tags","pe","skipNodeFiles","skipPackage","err","next","stderr","write"],"mappings":";;;;;;AAWA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,MAAMA,eAAeC,QAAQ,eAAR,CAArB,C,CA/BA;;;;;;;;;AAkCA,kBACGC,GADH,6CAEGA,GAFH,iCAGGC,IAHH,CAGQ;AACJC,WAAS,CAAC,IAAD,EAAO,IAAP,CADL;AAEJC,MAAI,CAAC,QAAD,EAAW,OAAX,CAFA;AAGJC,cAAY,QAHR;AAIJC,aAAW;AACTC,kBAAc;AADL,GAJP;AAOJC,WAAS;AACPC,cAAU,eAAKC,OAAL,CAAaC,SAAb,EAAwB,gCAAxB,CADH;AAEPC,aAAS,eAAKF,OAAL,CAAaC,SAAb,EAAwB,wCAAxB;AAFF;AAPL,CAHR;;AAgBA,MAAME,MAAM,wBAAZ;;AAEAA,IAAIC,GAAJ,CAAQ,aAAR,EAAuB,UAAvB;;AAEAD,IAAIZ,GAAJ,CAAQ,oBAAK;AACXc,SAAOA,MAAP,EAAeC,EAAf,EAAmB;AACjB,UAAMC,YAAYC,QAAQC,GAAR,CAAYC,WAAZ,GAA0BF,QAAQC,GAAR,CAAYC,WAAZ,CAAwBC,KAAxB,CAA8B,GAA9B,CAA1B,GAA+D,EAAjF;AACAL,OAAG,IAAH,EAASC,UAAUK,QAAV,CAAmBP,MAAnB,CAAT;AACD,GAJU;AAKXQ,eAAa;AALF,CAAL,CAAR;;AAQAV,IAAIZ,GAAJ,CAAQ,6BAAR;AACAY,IAAIZ,GAAJ,CAAQ,qBAAWuB,UAAX,CAAsB,EAAEC,UAAU,IAAZ,EAAtB,CAAR;AACAZ,IAAIZ,GAAJ,CAAQ,qBAAWyB,IAAX,EAAR;AACAb,IAAIZ,GAAJ,CAAQ,8BAAQ;AACd0B,SAAO,KAAK,qDAAL,EAA4B,EAAEC,uBAAF,EAA5B,CADO;AAEdC,QAAM,KAFQ;AAGdC,UAAQ,IAHM;AAIdC,qBAAmB,IAJL;AAKdC,UAAQd,QAAQC,GAAR,CAAYc;AALN,CAAR,CAAR;AAOApB,IAAIZ,GAAJ,CAAQ,mCAAkBiC,MAAlB,mBAAR;AACArB,IAAIZ,GAAJ,CAAQ,mBAASkC,UAAT,EAAR;AACAtB,IAAIZ,GAAJ,CAAQ,mBAASmC,OAAT,EAAR;AACAvB,IAAIZ,GAAJ,CAAQ,6BAAR;;AAEAY,IAAIZ,GAAJ;;AAEAY,IAAIwB,GAAJ,CAAQ,iBAAR,EAA2B,CAACC,GAAD,EAAMC,GAAN,KAAc;AACvCA,MAAIC,IAAJ,CAAS,YAAT,EAAuBC,IAAvB,CAA4B,2CAA5B;AACD,CAFD;;AAIA5B,IAAIZ,GAAJ,CAAQ,UAAR,EAAoB,8BAAeqC,QAAQ;AACzCI,0BADyC;AAEzCC,WAAS;AACPC,UAAMN,IAAIM;AADH,GAFgC;AAKzCC,YAAU3B,QAAQC,GAAR,CAAY2B,QAAZ,KAAyB,YALM;AAMzCC,UAAQ7B,QAAQC,GAAR,CAAY2B,QAAZ,KAAyB;AANQ,CAAR,CAAf,CAApB;;AASA;AACA,IAAI5B,QAAQC,GAAR,CAAY2B,QAAZ,KAAyB,YAA7B,EAA2C;AACzC;AACAjC,MAAIwB,GAAJ,CAAQ,iCAAR,EAA2C,CAACC,GAAD,EAAMC,GAAN,KAAc;AACvD,UAAMS,UAAU,gBAAMC,MAAN,CAAaX,IAAIY,MAAJ,CAAWC,QAAxB,EAAkC,EAAEC,GAAGd,IAAIc,CAAT,EAAYC,GAAG,GAAf,EAAlC,CAAhB;AACAd,QAAIE,IAAJ,CAASO,QAAQM,IAAjB;AACD,GAHD;;AAKA;AACAzC,MAAIwB,GAAJ,CAAQ,GAAR,EAAa,CAACC,GAAD,EAAMC,GAAN,KAAc;AACzB,QAAID,IAAIM,IAAR,EAAc;AACZL,UAAIE,IAAJ,CAAU,MAAKH,IAAIc,CAAJ,CAAM,oBAAN,EAA4B,EAAER,MAAMN,IAAIM,IAAJ,CAASW,KAAjB,EAA5B,CAAsD,8HAA6HjB,IAAIc,CAAJ,CAAM,SAAN,CAAiB,WAAnN;AACA,YAAMI,eAAe,IAAIzD,YAAJ,CAAiB,qDAAjB,CAArB;AACAyD,mBAAaC,aAAb,GAA6BC,IAA7B,CAAkCC,SAASC,QAAQC,GAAR,CAAYF,MAAMG,IAAN,CAAW,CAAX,EAAcC,IAA1B,CAA3C;AACD,KAJD,MAIO;AACL;AACAxB,UAAIE,IAAJ,CAAU,MAAKH,IAAIc,CAAJ,CAAM,iBAAN,CAAyB,gCAA+Bd,IAAIc,CAAJ,CAAM,SAAN,CAAiB,WAAxF;AACD;AACF,GATD;AAUD;;AAED,MAAMY,KAAK,2BAAX;AACAA,GAAGC,aAAH;AACAD,GAAGE,WAAH,CAAe,SAAf;;AAEArD,IAAIZ,GAAJ,CAAQ,CAACkE,GAAD,EAAM7B,GAAN,EAAWC,GAAX,EAAgB6B,IAAhB,KAAyB;AAC/BlD,UAAQmD,MAAR,CAAeC,KAAf,CAAqBN,GAAGf,MAAH,CAAUkB,GAAV,CAArB;AACAC;AACD,CAHD;;kBAKevD,G","file":"app.js","sourcesContent":["/**\n * Node.js API Starter Kit (https://reactstarter.com/nodejs)\n *\n * Copyright Â© 2016-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\n/* @flow */\n\nimport path from 'path';\nimport express from 'express';\nimport cors from 'cors';\nimport cookieParser from 'cookie-parser';\nimport bodyParser from 'body-parser';\nimport session from 'express-session';\nimport connectRedis from 'connect-redis';\nimport flash from 'express-flash';\nimport i18next from 'i18next';\nimport i18nextMiddleware, { LanguageDetector } from 'i18next-express-middleware';\nimport i18nextBackend from 'i18next-node-fs-backend';\nimport expressGraphQL from 'express-graphql';\nimport PrettyError from 'pretty-error';\nimport { printSchema } from 'graphql';\nimport email from './email';\nimport redis from './redis';\nimport passport from './passport';\nimport schema from './schema';\nimport accountRoutes from './routes/account';\n\nconst InstagramAPI = require('instagram-api');\n\n\ni18next\n  .use(LanguageDetector)\n  .use(i18nextBackend)\n  .init({\n    preload: ['en', 'de'],\n    ns: ['common', 'email'],\n    fallbackNS: 'common',\n    detection: {\n      lookupCookie: 'lng',\n    },\n    backend: {\n      loadPath: path.resolve(__dirname, '../locales/{{lng}}/{{ns}}.json'),\n      addPath: path.resolve(__dirname, '../locales/{{lng}}/{{ns}}.missing.json'),\n    },\n  });\n\nconst app = express();\n\napp.set('trust proxy', 'loopback');\n\napp.use(cors({\n  origin(origin, cb) {\n    const whitelist = process.env.CORS_ORIGIN ? process.env.CORS_ORIGIN.split(',') : [];\n    cb(null, whitelist.includes(origin));\n  },\n  credentials: true,\n}));\n\napp.use(cookieParser());\napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(bodyParser.json());\napp.use(session({\n  store: new (connectRedis(session))({ client: redis }),\n  name: 'sid',\n  resave: true,\n  saveUninitialized: true,\n  secret: process.env.SESSION_SECRET,\n}));\napp.use(i18nextMiddleware.handle(i18next));\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(flash());\n\napp.use(accountRoutes);\n\napp.get('/graphql/schema', (req, res) => {\n  res.type('text/plain').send(printSchema(schema));\n});\n\napp.use('/graphql', expressGraphQL(req => ({\n  schema,\n  context: {\n    user: req.user,\n  },\n  graphiql: process.env.NODE_ENV !== 'production',\n  pretty: process.env.NODE_ENV !== 'production',\n})));\n\n// The following routes are intended to be used in development mode only\nif (process.env.NODE_ENV !== 'production') {\n  // A route for testing email templates\n  app.get('/:email(email|emails)/:template', (req, res) => {\n    const message = email.render(req.params.template, { t: req.t, v: 123 });\n    res.send(message.html);\n  });\n\n  // A route for testing authentication/authorization\n  app.get('/', (req, res) => {\n    if (req.user) {\n      res.send(`<p>${req.t('Welcome, {{user}}!', { user: req.user.email })} (<a href=\"javascript:fetch('/login/clear', { method: 'POST', credentials: 'include' }).then(() => window.location = '/')\">${req.t('log out')}</a>)</p>`);\n      const instagramAPI = new InstagramAPI('4243299161.1677ed0.692b9153d5d34d84beb7d24f9c0842c1');\n      instagramAPI.userSelfMedia().then(media => console.log(media.data[0].tags));\n    } else {\n      // TODO: THIS NEEDS TO CHANGE IN INSTAGRAM\n      res.send(`<p>${req.t('Welcome, guest!')} (<a href=\"/login/instagram\">${req.t('sign in')}</a>)</p>`);\n    }\n  });\n}\n\nconst pe = new PrettyError();\npe.skipNodeFiles();\npe.skipPackage('express');\n\napp.use((err, req, res, next) => {\n  process.stderr.write(pe.render(err));\n  next();\n});\n\nexport default app;\n"]}